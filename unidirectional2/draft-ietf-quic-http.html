<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Hypertext Transfer Protocol (HTTP) over QUIC</title>

  
<style type="text/css">/*<![CDATA[*/
@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}

@media screen and (min-width: 1024px) {
  ul.toc, #rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    padding: 0 1em;
    z-index: 1;
  }
  #rfc\.toc {
    top: 16px;
  }
  ul.toc {
    top: 80px;
    overflow: auto;
  }

  body {
    padding-left: 1.5em;
    padding-right: 29em;
  }
}

body {
  font: 15px "Helvetica Neue",Helvetica,Arial,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 130%;
  margin: 2.5em auto;
  max-width: 724px;
}

.title, .filename, h1, h2, h3, h4 {
  font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
  font-size-adjust: 0.5;
  font-weight: 500;
  color: #333;
  line-height: 100%;
  margin: 0.8em 0 0.3em;
}
.title { font-size: 36px; }
h1 { font-size: 30px; }
h2 { font-size: 24px; }
h3, h4 { font-size: 18px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

ul.toc li {
  list-style: none;
  text-indent: -2.5em;
  padding-left: 2.5em;
  padding-bottom: 5px;
  margin: 0;
}
ul.toc ul {
  margin: 0;
}
/* xml2rfc nests ul directly inside ul which messes with the style badly */
ul.toc, ul.toc>ul, ul.toc ul>ul {
  margin: 0 0 0 1.5em;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header {
  width: 100%;
}
table.header td {
  border: none;
  background-color: transparent;
  color: black;
}
.filename {
  color: rgb(119, 119, 119);
  font-size: 23px;
  font-weight: normal;
  height: auto;
  line-height: 100%;
}
#rfc\.abstract+p {
  font-size: 20px;
  font-weight: 300;
  line-height: 130%;
}

samp, tt, code, pre {
  font: 11pt consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure {
  font-style: italic;
  margin: 0 1.5em;
}

address {
  margin: 10px 0 0;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn {
  font-weight: bold;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

ol, ul, li, p {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
li, p {
  margin-left: 0;
}
address {
  font-style: normal;
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
  /*]]>*/</style>


  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Notational Conventions"/>
<link href="#rfc.section.2" rel="Chapter" title="2 QUIC Advertisement"/>
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 QUIC Version Hints"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Connection Establishment"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Draft Version Identification"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Stream Mapping and Usage"/>
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Stream Type Identifier"/>
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 HTTP Message Exchanges"/>
<link href="#rfc.section.4.2.1" rel="Chapter" title="4.2.1 Header Compression"/>
<link href="#rfc.section.4.2.2" rel="Chapter" title="4.2.2 The CONNECT Method"/>
<link href="#rfc.section.4.2.3" rel="Chapter" title="4.2.3 Delta References"/>
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Stream Priorities"/>
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Flow Control"/>
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 Server Push"/>
<link href="#rfc.section.5" rel="Chapter" title="5 HTTP Framing Layer"/>
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Frame Layout"/>
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Frame Definitions"/>
<link href="#rfc.section.5.2.1" rel="Chapter" title="5.2.1 DATA"/>
<link href="#rfc.section.5.2.2" rel="Chapter" title="5.2.2 HEADERS"/>
<link href="#rfc.section.5.2.3" rel="Chapter" title="5.2.3 PRIORITY"/>
<link href="#rfc.section.5.2.4" rel="Chapter" title="5.2.4 RST_STREAM"/>
<link href="#rfc.section.5.2.5" rel="Chapter" title="5.2.5 SETTINGS"/>
<link href="#rfc.section.5.2.6" rel="Chapter" title="5.2.6 PUSH_PROMISE"/>
<link href="#rfc.section.5.2.7" rel="Chapter" title="5.2.7 PING"/>
<link href="#rfc.section.5.2.8" rel="Chapter" title="5.2.8 GOAWAY frame"/>
<link href="#rfc.section.5.2.9" rel="Chapter" title="5.2.9 WINDOW_UPDATE frame"/>
<link href="#rfc.section.5.2.10" rel="Chapter" title="5.2.10 CONTINUATION frame"/>
<link href="#rfc.section.5.2.11" rel="Chapter" title="5.2.11 RESPONSE frame"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Error Handling"/>
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 HTTP-Defined QUIC Error Codes"/>
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Mapping HTTP/2 Error Codes"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations"/>
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations"/>
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Registration of HTTP/QUIC Identification String"/>
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 Registration of QUIC Version Hint Alt-Svc Parameter"/>
<link href="#rfc.section.8.3" rel="Chapter" title="8.3 Existing Frame Types"/>
<link href="#rfc.references" rel="Chapter" title="9 References"/>
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="9.2 Informative References"/>
<link href="#rfc.appendix.A" rel="Chapter" title="A Contributors"/>
<link href="#rfc.appendix.B" rel="Chapter" title="B Change Log"/>
<link href="#rfc.appendix.B.1" rel="Chapter" title="B.1 Since draft-ietf-quic-http-01:"/>
<link href="#rfc.appendix.B.2" rel="Chapter" title="B.2 Since draft-ietf-quic-http-00:"/>
<link href="#rfc.appendix.B.3" rel="Chapter" title="B.3 Since draft-shade-quic-http2-mapping-00:"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.2 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Bishop, M., Ed." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-quic-http-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2017-2-24" />
  <meta name="dct.abstract" content="The QUIC transport protocol has several features that are desirable in a transport for HTTP, such as stream multiplexing, per-stream flow control, and low-latency connection establishment.  This document describes a mapping of HTTP semantics over QUIC.  Specifically, this document identifies HTTP/2 features that are subsumed by QUIC, and describes how the other features can be implemented atop QUIC." />
  <meta name="description" content="The QUIC transport protocol has several features that are desirable in a transport for HTTP, such as stream multiplexing, per-stream flow control, and low-latency connection establishment.  This document describes a mapping of HTTP semantics over QUIC.  Specifically, this document identifies HTTP/2 features that are subsumed by QUIC, and describes how the other features can be implemented atop QUIC." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">QUIC</td>
  <td class="right">M. Bishop, Ed.</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">Microsoft</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">February 24, 2017</td>
</tr>
<tr>
  <td class="left">Expires: August 28, 2017</td>
  <td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Hypertext Transfer Protocol (HTTP) over QUIC<br />
  <span class="filename">draft-ietf-quic-http-latest</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>The QUIC transport protocol has several features that are desirable in a transport for HTTP, such as stream multiplexing, per-stream flow control, and low-latency connection establishment.  This document describes a mapping of HTTP semantics over QUIC.  Specifically, this document identifies HTTP/2 features that are subsumed by QUIC, and describes how the other features can be implemented atop QUIC.</p>
<h1>
  <a>Note to Readers</a>
</h1>
<p>Discussion of this draft takes place on the QUIC working group mailing list (quic@ietf.org), which is archived at <a href="https://mailarchive.ietf.org/arch/search/?email_list=quic">https://mailarchive.ietf.org/arch/search/?email_list=quic</a>.</p>
<p>Working Group information can be found at <a href="https://github.com/quicwg">https://github.com/quicwg</a>; source code and issues list for this draft can be found at <a href="https://github.com/quicwg/base-drafts/labels/http">https://github.com/quicwg/base-drafts/labels/http</a>.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on August 28, 2017.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2017 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Notational Conventions</a></li>
</ul><li>2.   <a href="#rfc.section.2">QUIC Advertisement</a></li>
<ul><li>2.1.   <a href="#rfc.section.2.1">QUIC Version Hints</a></li>
</ul><li>3.   <a href="#rfc.section.3">Connection Establishment</a></li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Draft Version Identification</a></li>
</ul><li>4.   <a href="#rfc.section.4">Stream Mapping and Usage</a></li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Stream Type Identifier</a></li>
<li>4.2.   <a href="#rfc.section.4.2">HTTP Message Exchanges</a></li>
<ul><li>4.2.1.   <a href="#rfc.section.4.2.1">Header Compression</a></li>
<li>4.2.2.   <a href="#rfc.section.4.2.2">The CONNECT Method</a></li>
<li>4.2.3.   <a href="#rfc.section.4.2.3">Delta References</a></li>
</ul><li>4.3.   <a href="#rfc.section.4.3">Stream Priorities</a></li>
<li>4.4.   <a href="#rfc.section.4.4">Flow Control</a></li>
<li>4.5.   <a href="#rfc.section.4.5">Server Push</a></li>
</ul><li>5.   <a href="#rfc.section.5">HTTP Framing Layer</a></li>
<ul><li>5.1.   <a href="#rfc.section.5.1">Frame Layout</a></li>
<li>5.2.   <a href="#rfc.section.5.2">Frame Definitions</a></li>
<ul><li>5.2.1.   <a href="#rfc.section.5.2.1">DATA</a></li>
<li>5.2.2.   <a href="#rfc.section.5.2.2">HEADERS</a></li>
<li>5.2.3.   <a href="#rfc.section.5.2.3">PRIORITY</a></li>
<li>5.2.4.   <a href="#rfc.section.5.2.4">RST_STREAM</a></li>
<li>5.2.5.   <a href="#rfc.section.5.2.5">SETTINGS</a></li>
<li>5.2.6.   <a href="#rfc.section.5.2.6">PUSH_PROMISE</a></li>
<li>5.2.7.   <a href="#rfc.section.5.2.7">PING</a></li>
<li>5.2.8.   <a href="#rfc.section.5.2.8">GOAWAY frame</a></li>
<li>5.2.9.   <a href="#rfc.section.5.2.9">WINDOW_UPDATE frame</a></li>
<li>5.2.10.   <a href="#rfc.section.5.2.10">CONTINUATION frame</a></li>
<li>5.2.11.   <a href="#rfc.section.5.2.11">RESPONSE frame</a></li>
</ul></ul><li>6.   <a href="#rfc.section.6">Error Handling</a></li>
<ul><li>6.1.   <a href="#rfc.section.6.1">HTTP-Defined QUIC Error Codes</a></li>
<li>6.2.   <a href="#rfc.section.6.2">Mapping HTTP/2 Error Codes</a></li>
</ul><li>7.   <a href="#rfc.section.7">Security Considerations</a></li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a></li>
<ul><li>8.1.   <a href="#rfc.section.8.1">Registration of HTTP/QUIC Identification String</a></li>
<li>8.2.   <a href="#rfc.section.8.2">Registration of QUIC Version Hint Alt-Svc Parameter</a></li>
<li>8.3.   <a href="#rfc.section.8.3">Existing Frame Types</a></li>
</ul><li>9.   <a href="#rfc.references">References</a></li>
<ul><li>9.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>9.2.   <a href="#rfc.references.2">Informative References</a></li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">Contributors</a></li>
<li>Appendix B.   <a href="#rfc.appendix.B">Change Log</a></li>
<ul><li>B.1.   <a href="#rfc.appendix.B.1">Since draft-ietf-quic-http-01:</a></li>
<li>B.2.   <a href="#rfc.appendix.B.2">Since draft-ietf-quic-http-00:</a></li>
<li>B.3.   <a href="#rfc.appendix.B.3">Since draft-shade-quic-http2-mapping-00:</a></li>
</ul><li><a href="#rfc.authors">Author's Address</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a></h1>
<p id="rfc.section.1.p.1">The QUIC transport protocol has several features that are desirable in a transport for HTTP, such as stream multiplexing, per-stream flow control, and low-latency connection establishment. This document describes a mapping of HTTP semantics over QUIC, drawing heavily on the existing TCP mapping, HTTP/2.  Specifically, this document identifies HTTP/2 features that are subsumed by QUIC, and describes how the other features can be implemented atop QUIC.</p>
<p id="rfc.section.1.p.2">QUIC is described in <a href="#QUIC-TRANSPORT">[QUIC-TRANSPORT]</a>.  For a full description of HTTP/2, see <a href="#RFC7540">[RFC7540]</a>.</p>
<h2 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> <a href="#notational-conventions" id="notational-conventions">Notational Conventions</a></h2>
<p id="rfc.section.1.1.p.1">The words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;SHOULD&#8221;, and &#8220;MAY&#8221; are used in this document.  It&#8217;s not shouting; when they are capitalized, they have the special meaning defined in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#quic-advertisement" id="quic-advertisement">QUIC Advertisement</a></h1>
<p id="rfc.section.2.p.1">An HTTP origin advertises the availability of an equivalent HTTP/QUIC endpoint via the Alt-Svc HTTP response header or the HTTP/2 ALTSVC frame (<a href="#RFC7838">[RFC7838]</a>), using the ALPN token defined in <a href="#connection-establishment">Section 3</a>.</p>
<p id="rfc.section.2.p.2">For example, an origin could indicate in an HTTP/1.1 or HTTP/2 response that HTTP/QUIC was available on UDP port 443 at the same hostname by including the following header in any response:</p>
<pre>
Alt-Svc: hq=":443"
</pre>
<p id="rfc.section.2.p.3">On receipt of an Alt-Svc header indicating HTTP/QUIC support, a client MAY attempt to establish a QUIC connection to the indicated host and port and, if successful, send HTTP requests using the mapping described in this document.</p>
<p id="rfc.section.2.p.4">Connectivity problems (e.g. firewall blocking UDP) can result in QUIC connection establishment failure, in which case the client SHOULD continue using the existing connection or try another alternative endpoint offered by the origin.</p>
<h2 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a> <a href="#alt-svc-version-hint" id="alt-svc-version-hint">QUIC Version Hints</a></h2>
<p id="rfc.section.2.1.p.1">This document defines the &#8220;quic&#8221; parameter for Alt-Svc, which MAY be used to provide version-negotiation hints to HTTP/QUIC clients. QUIC versions are four-octet sequences with no additional constraints on format. Syntax:</p>
<pre>
quic = version-number
version-number = 1*8HEXDIG; hex-encoded QUIC version
</pre>
<p id="rfc.section.2.1.p.2">Leading zeros SHOULD be omitted for brevity.  When multiple versions are supported, the &#8220;quic&#8221; parameter MAY be repeated multiple times in a single Alt-Svc entry.  For example, if a server supported both version 0x00000001 and the version rendered in ASCII as &#8220;Q034&#8221;, it could specify the following header:</p>
<pre>
Alt-Svc: hq=":443";quic=1;quic=51303334
</pre>
<p id="rfc.section.2.1.p.3">Where multiple versions are listed, the order of the values reflects the server&#8217;s preference (with the first value being the most preferred version).  Origins SHOULD list only versions which are supported by the alternative, but MAY omit supported versions for any reason.</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#connection-establishment" id="connection-establishment">Connection Establishment</a></h1>
<p id="rfc.section.3.p.1">HTTP/QUIC connections are established as described in <a href="#QUIC-TRANSPORT">[QUIC-TRANSPORT]</a>. During connection establishment, HTTP/QUIC support is indicated by selecting the ALPN token &#8220;hq&#8221; in the crypto handshake.</p>
<p id="rfc.section.3.p.2">While connection-level options pertaining to the core QUIC protocol are set in the initial crypto handshake, HTTP-specific settings are conveyed in the SETTINGS frame. After the QUIC connection is established, a SETTINGS frame (<a href="#frame-settings">Section 5.2.5</a>) MUST be sent as the initial frame of the HTTP control stream (StreamID 3, see <a href="#stream-mapping">Section 4</a>).  The server MUST NOT send data on any other stream until the client&#8217;s SETTINGS frame has been received.</p>
<h2 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> <a href="#draft-version-identification" id="draft-version-identification">Draft Version Identification</a></h2>
<p/>

<ul class="empty">
  <li><strong>RFC Editor&#8217;s Note:</strong>  Please remove this section prior to publication of a final version of this document.</li>
</ul>
<p id="rfc.section.3.1.p.2">Only implementations of the final, published RFC can identify themselves as &#8220;hq&#8221;. Until such an RFC exists, implementations MUST NOT identify themselves using these strings.</p>
<p id="rfc.section.3.1.p.3">Implementations of draft versions of the protocol MUST add the string &#8220;-&#8220; and the corresponding draft number to the identifier. For example, draft-ietf-quic-http-01 is identified using the string &#8220;hq-01&#8221;.</p>
<p id="rfc.section.3.1.p.4">Non-compatible experiments that are based on these draft versions MUST append the string &#8220;-&#8220; and an experiment name to the identifier. For example, an experimental implementation based on draft-ietf-quic-http-09 which reserves an extra stream for unsolicited transmission of 1980s pop music might identify itself as &#8220;hq-09-rickroll&#8221;. Note that any label MUST conform to the &#8220;token&#8221; syntax defined in Section 3.2.6 of <a href="#RFC7230">[RFC7230]</a>. Experimenters are encouraged to coordinate their experiments on the quic@ietf.org mailing list.</p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#stream-mapping" id="stream-mapping">Stream Mapping and Usage</a></h1>
<p id="rfc.section.4.p.1">A QUIC stream provides reliable in-order delivery of bytes in one direction, but makes no guarantees about order of delivery with regard to bytes on other streams. On the wire, data is framed into QUIC STREAM frames, but this framing is invisible to the HTTP framing layer. A QUIC receiver buffers and orders received STREAM frames, exposing the data contained within as a reliable byte stream to the application.</p>
<p id="rfc.section.4.p.2">QUIC reserves Stream 1 in both directions for crypto operations (the handshake, crypto config updates). Each subsequent stream begins with a one-byte identifier that describes the stream type; see <a href="#stream-preface">Section 4.1</a> for more details.</p>
<p id="rfc.section.4.p.3">Stream 2 in both directions is reserved for sending and receiving HTTP control frames, and is analogous to Stream 0 in HTTP/2.  Since most connection-level concerns from HTTP/2 will be managed by QUIC, the primary use of Stream 2 will be for SETTINGS and PRIORITY frames.</p>
<p id="rfc.section.4.p.4">When HTTP headers and data are sent over QUIC, the QUIC layer handles most of the stream management. An HTTP request/response consumes up to two streams in each direction, with additional streams used by the server for promised responses.  Streams MUST be utilized sequentially by each peer, with no gaps.</p>
<p id="rfc.section.4.p.5">The first stream created for a request or response is a message control stream and carries frames related to the request/response, including HEADERS. The message control stream for a response to a client request MUST begin with a RESPONSE frame indicating the client&#8217;s message control stream to which it responds. Promised requests are carried by PUSH_PROMISE frames, which indicate the message control stream for the future response.</p>
<p id="rfc.section.4.p.6">For messages with bodies, a second stream is incorporated using a DATA frame.  This stream is a data stream and carries the message body with no additional framing.</p>
<p id="rfc.section.4.p.7">For example, the set of interconnected streams of a request/response might look like this:</p>
<pre>
Client                                                  Server

  Stream 21 [Request Control] =============================&gt;
    HEADERS [GET resource.html, etc.]

  &lt;==========================  Stream 300 [Response Control]
    RESPONSE [Delta=0, Direction=0, StreamReference=21]
    PUSH_PROMISE [Delta=1, Direction=1, StreamReference=1,
          HeaderBlock=[GET res.css]]
    HEADERS [200, etc.]
    DATA [Delta=1, Direction=1, StreamReference=2]
    PUSH_PROMISE [Delta=1, Direction=1, StreamReference=3,
          HeaderBlock=[GET scr.js]]

  &lt;==============================  Stream 301 [Push Control]
    HEADERS [200, etc.]
    DATA [Delta=1, Direction=1, StreamReference=3]

  &lt;======================================  Stream 302 [Data]
    (body of resource.html)

  &lt;==============================  Stream 303 [Push Control]
    HEADERS [200, etc.]
    DATA [Delta=1, Direction=1, StreamReference=2]

  &lt;======================================  Stream 304 [Data]
    (body of res.css)

  &lt;======================================  Stream 305 [Data]
    (body of scr.js)
</pre>
<p class="figure">Example Stream Exchange</p>
<p id="rfc.section.4.p.8">HTTP does not need to do any separate multiplexing when using QUIC - data sent over a QUIC stream always maps to a particular HTTP transaction. Requests and responses are considered complete when the corresponding QUIC streams are closed.</p>
<h2 id="rfc.section.4.1"><a href="#rfc.section.4.1">4.1.</a> <a href="#stream-preface" id="stream-preface">Stream Type Identifier</a></h2>
<p id="rfc.section.4.1.p.1">Each stream begins with a single byte identifying the stream type.  This permits safe processing of subsequent frames and correlation of requests and responses.  The defined stream types are:</p>
<p/>

<dl>
  <dt>Connection Control Stream (0x43):</dt>
  <dd style="margin-left: 8">Identifies the stream which will be used for connection-level control frames.  This MUST be the type of Stream 2; any other stream of this type MUST be treated as a session error of type HTTP_DUPLICATE_CONTROL_STREAM.  The first frame on this stream MUST be a SETTINGS frame (see <a href="#frame-settings">Section 5.2.5</a>).</dd>
  <dt>Request Control Stream (0x72):</dt>
  <dd style="margin-left: 8">Identifies the message control stream of an HTTP request from a client.  The frames on this stream will carry a single HTTP request.</dd>
  <dt>Response Control Stream (0x52):</dt>
  <dd style="margin-left: 8">Identifies the message control stream of a server&#8217;s response to a client&#8217;s HTTP request.  The first frame on this stream MUST be a RESPONSE frame (see <a href="#frame-response">Section 5.2.11</a>) identifying the control stream of an HTTP client&#8217;s request.  Subsequent frames on this stream will a single HTTP response.</dd>
  <dt>Push Control Stream (0x50):</dt>
  <dd style="margin-left: 8">Identifies the message control stream of a server&#8217;s pushed response.  The frames on this stream will carry a single pushed HTTP response.</dd>
  <dt>Data Stream (0x44):</dt>
  <dd style="margin-left: 8">Identifies a data stream carrying the body of an HTTP request or response. The contents of this stream MUST NOT be interpreted as frames.  The body SHOULD NOT be interpreted in any way until the stream has been explicitly referenced by a DATA frame on a message control stream.</dd>
</dl>
<h2 id="rfc.section.4.2"><a href="#rfc.section.4.2">4.2.</a> <a href="#http-message-exchanges" id="http-message-exchanges">HTTP Message Exchanges</a></h2>
<p id="rfc.section.4.2.p.1">A client begins sending an HTTP request on a new QUIC stream, identifying the stream as a Request Control Stream.</p>
<p id="rfc.section.4.2.p.2">An HTTP message (request or response) consists of:</p>
<p/>

<ol>
  <li>one header block (see <a href="#frame-headers">Section 5.2.2</a>) on the control stream containing the message headers (see <a href="#RFC7230">[RFC7230]</a>, Section 3.2),</li>
  <li>optionally:  <ul><li>the payload body (see <a href="#RFC7230">[RFC7230]</a>, Section 3.3), sent on a new Data Stream, and</li><li>a DATA frame on the control stream indicating the associated Data Stream</li></ul></li>
  <li>optionally, one header block on the control stream containing the trailer-part, if present (see <a href="#RFC7230">[RFC7230]</a>, Section 4.1.2).</li>
</ol>
<p id="rfc.section.4.2.p.4">A response is sent on a Response Control Stream or a Push Control Stream.  Prior to sending the message header block indicated above, a response contains:</p>
<p/>

<ul>
  <li>a RESPONSE frame indicating which client stream contained the original request, if any (not present for pushed responses)</li>
  <li>zero or more header blocks on the control stream containing the message headers of informational (1xx) HTTP responses (see <a href="#RFC7230">[RFC7230]</a>, Section 3.2 and <a href="#RFC7231">[RFC7231]</a>, Section 6.2)</li>
</ul>
<p id="rfc.section.4.2.p.6">The data stream MUST be closed immediately after the transfer of the body. The &#8220;chunked&#8221; transfer encoding defined in Section 4.1 of <a href="#RFC7230">[RFC7230]</a> MUST NOT be used.</p>
<p id="rfc.section.4.2.p.7">Trailing header fields are carried in an additional header block on the message control stream. Such a header block is a sequence of HEADERS frames with End Header Block set on the last frame. Senders MUST send only one header block in the trailers section; receivers MUST decode any subsequent header blocks in order to maintain HPACK decoder state, but the resulting output MUST be discarded.</p>
<p id="rfc.section.4.2.p.8">An HTTP request/response exchange fully consumes one or two streams in each direction, or more if server push is used (see <a href="#server-push">Section 4.5</a>). After sending a request or a response, a peer closes its stream(s).</p>
<p id="rfc.section.4.2.p.9">A server can send a complete response prior to the client sending an entire request if the response does not depend on any portion of the request that has not been sent and received. When this is true, a server MAY request that the client abort transmission of a request without error by triggering a QUIC REQUEST_RST on the client&#8217;s data stream. Clients MUST NOT discard complete responses as a result of receiving a REQUEST_RST, though clients can always discard responses at their discretion for other reasons.</p>
<h3 id="rfc.section.4.2.1"><a href="#rfc.section.4.2.1">4.2.1.</a> <a href="#header-compression" id="header-compression">Header Compression</a></h3>
<p id="rfc.section.4.2.1.p.1">HTTP/QUIC uses HPACK header compression as described in <a href="#RFC7541">[RFC7541]</a>. HPACK was designed for HTTP/2 with the assumption of in- order delivery such as that provided by TCP. A sequence of encoded header blocks must arrive (and be decoded) at an endpoint in the same order in which they were encoded. This ensures that the dynamic state at the two endpoints remains in sync.</p>
<p id="rfc.section.4.2.1.p.2">QUIC streams provide in-order delivery of data sent on those streams, but there are no guarantees about order of delivery between streams. To achieve in-order delivery of HEADERS frames in QUIC, the HPACK-bearing frames contain a counter which can be used to ensure in-order processing. Data (request/response bodies) which arrive out of order are buffered until the corresponding HEADERS arrive.</p>
<p id="rfc.section.4.2.1.p.3">This does introduce head-of-line blocking: if the packet containing HEADERS for stream N is lost or reordered then the HEADERS for stream N+4 cannot be processed until it has been retransmitted successfully, even though the HEADERS for stream N+4 may have arrived.</p>
<p/>

<dl>
  <dt>DISCUSS:</dt>
  <dd style="margin-left: 8">Keep HPACK with HOLB? Redesign HPACK to be order-invariant? How much do we need to retain compatibility with HTTP/2&#8217;s HPACK?</dd>
  <dt></dt>
  <dd style="margin-left: 8">This stream design presumes that control streams can be safely aborted, which is not true of HPACK.  Requires adopting an abort-safe header compression scheme.</dd>
</dl>
<h3 id="rfc.section.4.2.2"><a href="#rfc.section.4.2.2">4.2.2.</a> <a href="#the-connect-method" id="the-connect-method">The CONNECT Method</a></h3>
<p id="rfc.section.4.2.2.p.1">The pseudo-method CONNECT (<a href="#RFC7231">[RFC7231]</a>, Section 4.3.6) is primarily used with HTTP proxies to establish a TLS session with an origin server for the purposes of interacting with &#8220;https&#8221; resources. In HTTP/1.x, CONNECT is used to convert an entire HTTP connection into a tunnel to a remote host. In HTTP/2, the CONNECT method is used to establish a tunnel over a single HTTP/2 stream to a remote host for similar purposes.</p>
<p id="rfc.section.4.2.2.p.2">A CONNECT request in HTTP/QUIC functions in a similar manner as in HTTP/2, establishing a bidirectional TCP connection over a pair of QUIC streams. The request MUST be formatted as described in <a href="#RFC7540">[RFC7540]</a>, Section 8.3. A CONNECT request that does not conform to these restrictions is malformed. The message control stream carries a DATA frame indicating the client data stream which will carry the TCP traffic in the client-to-server direction.</p>
<p id="rfc.section.4.2.2.p.3">A proxy that supports CONNECT establishes a TCP connection (<a href="#RFC0793">[RFC0793]</a>) to the server identified in the &#8220;:authority&#8221; pseudo-header field. Once this connection is successfully established, the proxy sends a HEADERS frame containing a 2xx series status code to the client, as defined in <a href="#RFC7231">[RFC7231]</a>, Section 4.3.6, on the message control stream, followed by a DATA frame indicating the server data stream which will carry the TCP traffic in the server-to-client direction.</p>
<p id="rfc.section.4.2.2.p.4">All QUIC STREAM frames on the message data streams correspond to data sent on the TCP connection. Any QUIC STREAM frame sent by the client is transmitted by the proxy to the TCP server; data received from the TCP server is written to the server&#8217;s data stream by the proxy. Note that the size and number of TCP segments is not guaranteed to map predictably to the size and number of QUIC STREAM frames.</p>
<p id="rfc.section.4.2.2.p.5">The TCP connection can be closed by either peer. When the client closes its data stream, the proxy will set the FIN bit on its connection to the TCP server. When the proxy receives a packet with the FIN bit set, it will close its corresponding data stream. TCP connections which remain half-closed in a single direction are not invalid, but are often handled poorly by servers, so clients SHOULD NOT close data streams while they are still expecting to receive data on the server&#8217;s stream.</p>
<p id="rfc.section.4.2.2.p.6">A TCP connection error is signaled with RST_STREAM. A proxy treats any error in the TCP connection, which includes receiving a TCP segment with the RST bit set, as a stream error of type HTTP_CONNECT_ERROR (<a href="#http-error-codes">Section 6.1</a>).  Correspondingly, a proxy MUST send a TCP segment with the RST bit set if it detects an error with the stream or the QUIC connection.</p>
<h3 id="rfc.section.4.2.3"><a href="#rfc.section.4.2.3">4.2.3.</a> <a href="#stream-delta" id="stream-delta">Delta References</a></h3>
<p id="rfc.section.4.2.3.p.1">As described in <a href="#stream-mapping">Section 4</a>, an HTTP request and response can encompass one or more streams in each direction.  DATA, PUSH_PROMISE, and RESPONSE frames are used to correlate them.</p>
<p id="rfc.section.4.2.3.p.2">Because related streams will often be near each other in the Stream ID space, it will often be efficient to encode the referenced stream ID relative to the stream on which these frames are sent.  When this is the case, the Delta flag may be used to indicate that the Stream Reference field should be added to (Direction flag set) or subtracted from (Direction flag unset) the current Stream ID.</p>
<p id="rfc.section.4.2.3.p.3">If the stream indicated by a Delta Reference is not a valid QUIC stream number (e.g. a DATA frame on Stream 6 has the Delta flag set, the Direction flag unset, and a Stream Reference value of 100), the connection MUST be closed with an error of type HTTP_INVALID_STREAM_REFERENCE.</p>
<p id="rfc.section.4.2.3.p.4">Each stream may be referenced only once by another stream.  If a duplicate reference is detected, it MUST be treated as a stream error of type HTTP_DUPLICATE_REFERENCE on the referenced stream and all streams which reference it.</p>
<h2 id="rfc.section.4.3"><a href="#rfc.section.4.3">4.3.</a> <a href="#priority" id="priority">Stream Priorities</a></h2>
<p id="rfc.section.4.3.p.1">HTTP/QUIC uses the priority scheme described in <a href="#RFC7540">[RFC7540]</a> Section 5.3. In this priority scheme, a given stream can be designated as dependent upon another stream, which expresses the preference that the latter stream (the &#8220;parent&#8221; stream) be allocated resources before the former stream (the &#8220;dependent&#8221; stream). Taken together, the dependencies across all streams in a connection form a dependency tree. The structure of the dependency tree changes as HEADERS and PRIORITY frames add, remove, or change the dependency links between streams.</p>
<p id="rfc.section.4.3.p.2">Implicit in this scheme is the notion of in-order delivery of priority changes (i.e., dependency tree mutations): since operations on the dependency tree such as reparenting a subtree are not commutative, both sender and receiver must apply them in the same order to ensure that both sides have a consistent view of the stream dependency tree. HTTP/2 specifies priority assignments in PRIORITY frames and (optionally) in HEADERS frames. To achieve in-order delivery of priority changes in HTTP/QUIC, PRIORITY frames are sent on the connection control stream and the PRIORITY section is removed from the HEADERS frame. The semantics of the Stream Dependency, Weight, E flag, and (for HEADERS frames) PRIORITY flag are the same as in HTTP/2.</p>
<p id="rfc.section.4.3.p.3">For consistency&#8217;s sake, all PRIORITY frames MUST refer to the client&#8217;s message control stream of the dependent request, not the data stream or any associated server stream.</p>
<h2 id="rfc.section.4.4"><a href="#rfc.section.4.4">4.4.</a> <a href="#flow-control" id="flow-control">Flow Control</a></h2>
<p id="rfc.section.4.4.p.1">QUIC provides stream and connection level flow control, similar in principle to HTTP/2&#8217;s flow control but with some implementation differences.  As flow control is handled by QUIC, the HTTP mapping need not concern itself with maintaining flow control state.  The HTTP mapping MUST NOT send WINDOW_UPDATE frames at the HTTP level.</p>
<h2 id="rfc.section.4.5"><a href="#rfc.section.4.5">4.5.</a> <a href="#server-push" id="server-push">Server Push</a></h2>
<p id="rfc.section.4.5.p.1">HTTP/QUIC supports server push as described in <a href="#RFC7540">[RFC7540]</a>. During connection establishment, the client indicates whether it is willing to receive server pushes via the SETTINGS_ENABLE_PUSH setting in the SETTINGS frame (see <a href="#connection-establishment">Section 3</a>), which defaults to 1 (true).</p>
<p id="rfc.section.4.5.p.2">Similar to server push for HTTP/2, the server initiates a server push by sending a PUSH_PROMISE frame containing the Stream ID of the stream to be pushed, as well as request header fields attributed to the request. The PUSH_PROMISE frame is sent on the control stream being used to respond to the request, with the Stream Reference field specifying the Stream ID of the control stream for the response.</p>
<p id="rfc.section.4.5.p.3">On that stream, the server push response is conveyed in the same way as a non-server-push response, with response headers and (if present) trailers carried by HEADERS frames sent on the control stream, and response body (if any) sent via the corresponding data stream and indicated using a DATA frame.  No RESPONSE frame is used to indicate a request stream.</p>
<p id="rfc.section.4.5.p.4">If a promised push stream is not needed by the client, the client SHOULD send a QUIC REQUEST_RST on the promised stream with an appropriate error code (e.g.  HTTP_PUSH_REFUSED, HTTP_PUSH_ALREADY_IN_CACHE; see <a href="#errors">Section 6</a>).  This asks the server not to transfer the data and indicates that it will be discarded upon receipt.</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#http-framing-layer" id="http-framing-layer">HTTP Framing Layer</a></h1>
<p id="rfc.section.5.p.1">Many framing concepts from HTTP/2 can be elided away on QUIC, because the transport deals with them. Because frames are already on a stream, they can omit the stream number unless the payload of the frame refers to another stream.  Because frames do not block multiplexing (QUIC&#8217;s multiplexing occurs below this layer), the support for variable-maximum-length packets can be removed. Because stream termination is handled by QUIC, an END_STREAM flag is not required.</p>
<p id="rfc.section.5.p.2">Frames are used only on the connection (stream 3) and message (streams 5, 9, etc.) control streams. Other streams carry data payload and are not framed at the HTTP layer.</p>
<p id="rfc.section.5.p.3">Frame payloads are largely drawn from <a href="#RFC7540">[RFC7540]</a>. However, QUIC includes some features (e.g. flow control) which are also present in HTTP/2. In these cases, the HTTP mapping need not re-implement them. As a result, some frame types are not required when using QUIC. Where an HTTP/2-defined frame is no longer used, the frame ID is reserved in order to maximize portability between HTTP/2 and HTTP/QUIC implementations. However, equivalent frames between the two mappings are not identical.</p>
<p id="rfc.section.5.p.4">This section describes HTTP framing in QUIC and highlights differences from HTTP/2 framing.</p>
<h2 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1.</a> <a href="#frame-layout" id="frame-layout">Frame Layout</a></h2>
<p id="rfc.section.5.1.p.1">All frames have the following format:</p>
<div id="rfc.figure.1"/>
<div id="fig-frame"/>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Length (16)         |     Type (8)  |   Flags (8)   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       Frame Payload (*)                     ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p class="figure">Figure 1: HTTP/QUIC frame format</p>
<h2 id="rfc.section.5.2"><a href="#rfc.section.5.2">5.2.</a> <a href="#frames" id="frames">Frame Definitions</a></h2>
<h3 id="rfc.section.5.2.1"><a href="#rfc.section.5.2.1">5.2.1.</a> <a href="#frame-data" id="frame-data">DATA</a></h3>
<p id="rfc.section.5.2.1.p.1">The DATA frame (type=0x00) is used to identify the Data Stream on which the server intends to send the  body associated with an HTTP message.  It defines the following flags:</p>
<p/>

<dl>
  <dt>Delta (0x01):</dt>
  <dd style="margin-left: 8">Indicates the length and interpretation of the Stream Reference field.</dd>
  <dt>Direction (0x02):</dt>
  <dd style="margin-left: 8">When the Delta flag is set, indicates whether the reference is to a higher (set) or lower (unset) Stream ID.  MUST NOT be set if the Delta flag is not set.</dd>
</dl>
<div id="rfc.figure.2"/>
<div id="fig-data"/>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Stream Reference (8/32)                  ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p class="figure">Figure 2: DATA frame payload</p>
<p id="rfc.section.5.2.1.p.3">The payload consists of:</p>
<p/>

<dl>
  <dt>Stream Reference:</dt>
  <dd style="margin-left: 8">When the Delta flag is set, this field is 8 bits long and is relative to the current Stream ID.  Otherwise, this field is 32 bits long and is an explicit Stream ID.</dd>
</dl>
<p id="rfc.section.5.2.1.p.5">See <a href="#stream-delta">Section 4.2.3</a> for more information about stream-to-stream references.</p>
<h3 id="rfc.section.5.2.2"><a href="#rfc.section.5.2.2">5.2.2.</a> <a href="#frame-headers" id="frame-headers">HEADERS</a></h3>
<p id="rfc.section.5.2.2.p.1">The HEADERS frame (type=0x1) is used to carry part of a header set, compressed using HPACK <a href="#RFC7541">[RFC7541]</a>. Because HEADERS frames from different streams will be delivered out-of-order and priority-changes are not commutative, the PRIORITY region of HEADERS is not supported. A separate PRIORITY frame MUST be used.</p>
<p id="rfc.section.5.2.2.p.2">HTTP/2 padding is not defined and MUST NOT be used.  One flag is defined:</p>
<p/>

<dl>
  <dt>End Header Block (0x4):</dt>
  <dd style="margin-left: 8">This frame concludes a header block.</dd>
</dl>
<p id="rfc.section.5.2.2.p.4">A HEADERS frame with any other flags set MUST be treated as a connection error of type HTTP_MALFORMED_HEADERS.</p>
<div id="rfc.figure.3"/>
<div id="fig-headers"/>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Sequence? (16)          |    Header Block Fragment (*)...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p class="figure">Figure 3: HEADERS frame payload</p>
<p id="rfc.section.5.2.2.p.5">The HEADERS frame payload has the following fields:</p>
<p/>

<dl>
  <dt>Sequence Number:</dt>
  <dd style="margin-left: 8">Present only on the first frame of a header block sequence. This MUST be set to zero on the first header block sequence, and incremented on each header block.</dd>
</dl>
<p id="rfc.section.5.2.2.p.7">The next frame on the same stream after a HEADERS frame without the EHB flag set MUST be another HEADERS frame. A receiver MUST treat the receipt of any other type of frame as a stream error of type HTTP_INTERRUPTED_HEADERS. (Note that QUIC can intersperse data from other streams between frames, or even during transmission of frames, so multiplexing is not blocked by this requirement.)</p>
<p id="rfc.section.5.2.2.p.8">A full header block is contained in a sequence of zero or more HEADERS frames without EHB set, followed by a HEADERS frame with EHB set.</p>
<p id="rfc.section.5.2.2.p.9">On receipt, header blocks (HEADERS, PUSH_PROMISE) MUST be processed by the HPACK decoder in sequence. If a block is missing, all subsequent HPACK frames MUST be held until it arrives, or the connection terminated.</p>
<p id="rfc.section.5.2.2.p.10">When the Sequence counter reaches its maximum value (0xFFFF), the next increment returns it to zero.  An endpoint MUST NOT wrap the Sequence counter to zero until the previous zero-value header block has been confirmed received.</p>
<h3 id="rfc.section.5.2.3"><a href="#rfc.section.5.2.3">5.2.3.</a> <a href="#frame-priority" id="frame-priority">PRIORITY</a></h3>
<p id="rfc.section.5.2.3.p.1">The PRIORITY (type=0x02) frame specifies the sender-advised priority of a stream and is substantially different from <a href="#RFC7540">[RFC7540]</a>. In order to support ordering, it MUST be sent only on the connection control stream. The format has been modified to accommodate not being sent on-stream and the larger stream ID space of QUIC.</p>
<p id="rfc.section.5.2.3.p.2">The flags defined are:</p>
<p/>

<dl>
  <dt>E (0x01):</dt>
  <dd style="margin-left: 8">Indicates that the stream dependency is exclusive (see <a href="#RFC7540">[RFC7540]</a> Section 5.3).</dd>
</dl>
<div id="rfc.figure.4"/>
<div id="fig-priority"/>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                   Prioritized Stream (32)                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Dependent Stream (32)                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Weight (8)  |
   +-+-+-+-+-+-+-+-+
</pre>
<p class="figure">Figure 4: PRIORITY frame payload</p>
<p id="rfc.section.5.2.3.p.4">The HEADERS frame payload has the following fields:</p>
<p/>

<dl>
  <dt>Prioritized Stream:</dt>
  <dd style="margin-left: 8">A 32-bit stream identifier for the message control stream whose priority is being updated.</dd>
  <dt>Stream Dependency:</dt>
  <dd style="margin-left: 8">A 32-bit stream identifier for the stream that this stream depends on (see <a href="#priority">Section 4.3</a> and {!RFC7540}} Section 5.3).</dd>
  <dt>Weight:</dt>
  <dd style="margin-left: 8">An unsigned 8-bit integer representing a priority weight for the stream (see <a href="#RFC7540">[RFC7540]</a> Section 5.3). Add one to the value to obtain a weight between 1 and 256.</dd>
</dl>
<p id="rfc.section.5.2.3.p.6">A PRIORITY frame MUST have a payload length of nine octets.  A PRIORITY frame of any other length MUST be treated as a connection error of type HTTP_MALFORMED_PRIORITY.</p>
<h3 id="rfc.section.5.2.4"><a href="#rfc.section.5.2.4">5.2.4.</a> <a href="#rststream" id="rststream">RST_STREAM</a></h3>
<p id="rfc.section.5.2.4.p.1">RST_STREAM frames do not exist, since QUIC provides stream lifecycle management.  Frame type 0x3 is reserved.</p>
<h3 id="rfc.section.5.2.5"><a href="#rfc.section.5.2.5">5.2.5.</a> <a href="#frame-settings" id="frame-settings">SETTINGS</a></h3>
<p id="rfc.section.5.2.5.p.1">The SETTINGS frame (type=0x4) conveys configuration parameters that affect how endpoints communicate, such as preferences and constraints on peer behavior, and is substantially different from <a href="#RFC7540">[RFC7540]</a>. Individually, a SETTINGS parameter can also be referred to as a &#8220;setting&#8221;.</p>
<p id="rfc.section.5.2.5.p.2">SETTINGS parameters are not negotiated; they describe characteristics of the sending peer, which can be used by the receiving peer. However, a negotiation can be implied by the use of SETTINGS &#8211; a peer uses SETTINGS to advertise a set of supported values. The recipient can then choose which entries from this list are also acceptable and proceed with the value it has chosen. (This choice could be announced in a field of an extension frame, or in its own value in SETTINGS.)</p>
<p id="rfc.section.5.2.5.p.3">Different values for the same parameter can be advertised by each peer. For example, a client might permit a very large HPACK state table while a server chooses to use a small one to conserve memory.</p>
<p id="rfc.section.5.2.5.p.4">Parameters MUST NOT occur more than once.  A receiver MAY treat the presence of the same parameter more than once as a connection error of type HTTP_MALFORMED_SETTINGS.</p>
<p id="rfc.section.5.2.5.p.5">The SETTINGS frame defines no flags.</p>
<p id="rfc.section.5.2.5.p.6">The payload of a SETTINGS frame consists of zero or more parameters, each consisting of an unsigned 16-bit setting identifier and a length-prefixed binary value.</p>
<div id="rfc.figure.5"/>
<div id="fig-ext-settings"/>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        Identifier (16)        |         Length (16)           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          Contents (?)                       ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p class="figure">Figure 5: SETTINGS value format</p>
<p id="rfc.section.5.2.5.p.7">A zero-length content indicates that the setting value is a Boolean and true.  False is indicated by the absence of the setting.</p>
<p id="rfc.section.5.2.5.p.8">Non-zero-length values MUST be compared against the remaining length of the SETTINGS frame.  Any value which purports to cross the end of the frame MUST cause the SETTINGS frame to be considered malformed and trigger a connection error of type HTTP_MALFORMED_SETTINGS.</p>
<p id="rfc.section.5.2.5.p.9">An implementation MUST ignore the contents for any SETTINGS identifier it does not understand.</p>
<p id="rfc.section.5.2.5.p.10">SETTINGS frames always apply to a connection, never a single stream.  A SETTINGS frame MUST be sent as the first frame of the connection control stream (see <a href="#stream-mapping">Section 4</a>) by each peer, and MUST NOT be sent subsequently or on any other stream. If an endpoint receives an SETTINGS frame on a different stream, the endpoint MUST respond with a connection error of type HTTP_SETTINGS_ON_WRONG_STREAM.  If an endpoint receives a second SETTINGS frame, the endpoint MUST respond with a connection error of type HTTP_MULTIPLE_SETTINGS.</p>
<p id="rfc.section.5.2.5.p.11">The SETTINGS frame affects connection state. A badly formed or incomplete SETTINGS frame MUST be treated as a connection error (Section 5.4.1) of type HTTP_MALFORMED_SETTINGS.</p>
<h4 id="rfc.section.5.2.5.1"><a href="#rfc.section.5.2.5.1">5.2.5.1.</a> <a href="#integer-encoding" id="integer-encoding">Integer encoding</a></h4>
<p id="rfc.section.5.2.5.1.p.1">Settings which are integers are transmitted in network byte order.  Leading zero octets are permitted, but implementations SHOULD use only as many bytes as are needed to represent the value.  An integer MUST NOT be represented in more bytes than would be used to transfer the maximum permitted value.</p>
<h4 id="rfc.section.5.2.5.2"><a href="#rfc.section.5.2.5.2">5.2.5.2.</a> <a href="#defined-settings-parameters" id="defined-settings-parameters">Defined SETTINGS Parameters</a></h4>
<p id="rfc.section.5.2.5.2.p.1">Some transport-level options that HTTP/2 specifies via the SETTINGS frame are superseded by QUIC transport parameters in HTTP/QUIC. Below is a listing of how each HTTP/2 SETTINGS parameter is mapped:</p>
<p/>

<dl>
  <dt>SETTINGS_HEADER_TABLE_SIZE:</dt>
  <dd style="margin-left: 8">An integer with a maximum value of 2^32 - 1.</dd>
  <dt>SETTINGS_DISABLE_PUSH:</dt>
  <dd style="margin-left: 8">Transmitted as a Boolean; replaces SETTINGS_ENABLE_PUSH</dd>
  <dt>SETTINGS_MAX_CONCURRENT_STREAMS:</dt>
  <dd style="margin-left: 8">QUIC requires the maximum number of incoming streams per connection to be specified in the initial crypto handshake, using the &#8220;MSPC&#8221; tag.  Specifying SETTINGS_MAX_CONCURRENT_STREAMS in the SETTINGS frame is an error.</dd>
  <dt>SETTINGS_INITIAL_WINDOW_SIZE:</dt>
  <dd style="margin-left: 8">QUIC requires both stream and connection flow control window sizes to be specified in the initial crypto handshake, using the &#8220;SFCW&#8221; and &#8220;CFCW&#8221; tags, respectively.  Specifying SETTINGS_INITIAL_WINDOW_SIZE in the SETTINGS frame is an error.</dd>
  <dt>SETTINGS_MAX_FRAME_SIZE:</dt>
  <dd style="margin-left: 8">This setting has no equivalent in QUIC.  Specifying it in the SETTINGS frame is an error.</dd>
  <dt>SETTINGS_MAX_HEADER_LIST_SIZE:</dt>
  <dd style="margin-left: 8">An integer with a maximum value of 2^32 - 1.</dd>
</dl>
<h4 id="rfc.section.5.2.5.3"><a href="#rfc.section.5.2.5.3">5.2.5.3.</a> <a href="#usage-in-0-rtt" id="usage-in-0-rtt">Usage in 0-RTT</a></h4>
<p id="rfc.section.5.2.5.3.p.1">When a 0-RTT QUIC connection is being used, the client&#8217;s initial requests will be sent before the arrival of the server&#8217;s SETTINGS frame.  Clients SHOULD cache at least the following settings about servers:</p>
<p/>

<ul>
  <li>SETTINGS_HEADER_TABLE_SIZE</li>
  <li>SETTINGS_MAX_HEADER_LIST_SIZE</li>
</ul>
<p id="rfc.section.5.2.5.3.p.3">Clients MUST comply with cached settings until the server&#8217;s current settings are received.  If a client does not have cached values, it SHOULD assume the following values:</p>
<p/>

<ul>
  <li>SETTINGS_HEADER_TABLE_SIZE:  0 octets</li>
  <li>SETTINGS_MAX_HEADER_LIST_SIZE:  16,384 octets</li>
</ul>
<p id="rfc.section.5.2.5.3.p.5">Servers MAY continue processing data from clients which exceed its current configuration during the initial flight.  In this case, the client MUST apply the new settings immediately upon receipt.</p>
<p id="rfc.section.5.2.5.3.p.6">If the connection is closed because these or other constraints were violated during the 0-RTT flight (e.g. with HTTP_HPACK_DECOMPRESSION_FAILED), clients MAY establish a new connection and retry any 0-RTT requests using the settings sent by the server on the closed connection. (This assumes that only requests that are safe to retry are sent in 0-RTT.) If the connection was closed before the SETTINGS frame was received, clients SHOULD discard any cached values and use the defaults above on the next connection.</p>
<h3 id="rfc.section.5.2.6"><a href="#rfc.section.5.2.6">5.2.6.</a> <a href="#frame-push-promise" id="frame-push-promise">PUSH_PROMISE</a></h3>
<p id="rfc.section.5.2.6.p.1">The PUSH_PROMISE frame (type=0x05) is used to carry a request header set from server to client, similar to PUSH_PROMISE in HTTP/2, and identify the Push Control Stream on which the server intends to send the response.  It defines the following flags:</p>
<p/>

<dl>
  <dt>Delta (0x01):</dt>
  <dd style="margin-left: 8">Indicates the length and interpretation of the Stream Reference field.</dd>
  <dt>Direction (0x02):</dt>
  <dd style="margin-left: 8">When the Delta flag is set, indicates whether the reference is to a higher (set) or lower (unset) Stream ID.  MUST NOT be set if the Delta flag is not set.</dd>
</dl>
<div id="rfc.figure.6"/>
<div id="fig-push-promise"/>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Stream Reference (8/32)                  ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Sequence (16)         |       Header Block (*)      ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p class="figure">Figure 6: PUSH_PROMISE frame payload</p>
<p id="rfc.section.5.2.6.p.3">The payload consists of:</p>
<p/>

<dl>
  <dt>Stream Reference:</dt>
  <dd style="margin-left: 8">When the Delta flag is set, this field is 8 bits long and is relative to the current Stream ID.  Otherwise, this field is 32 bits long and is an explicit Stream ID.</dd>
  <dt>HPACK Sequence:</dt>
  <dd style="margin-left: 8">A sixteen-bit counter, equivalent to the Sequence field in HEADERS.</dd>
  <dt>Header Block:</dt>
  <dd style="margin-left: 8">HPACK-compressed request headers for the promised response.</dd>
</dl>
<p id="rfc.section.5.2.6.p.5">See <a href="#stream-delta">Section 4.2.3</a> for more information about stream-to-stream references.</p>
<h3 id="rfc.section.5.2.7"><a href="#rfc.section.5.2.7">5.2.7.</a> <a href="#ping" id="ping">PING</a></h3>
<p id="rfc.section.5.2.7.p.1">PING frames do not exist, since QUIC provides equivalent functionality. Frame type 0x6 is reserved.</p>
<h3 id="rfc.section.5.2.8"><a href="#rfc.section.5.2.8">5.2.8.</a> <a href="#goaway-frame" id="goaway-frame">GOAWAY frame</a></h3>
<p id="rfc.section.5.2.8.p.1">GOAWAY frames do not exist, since QUIC provides equivalent functionality. Frame type 0x7 is reserved.</p>
<h3 id="rfc.section.5.2.9"><a href="#rfc.section.5.2.9">5.2.9.</a> <a href="#windowupdate-frame" id="windowupdate-frame">WINDOW_UPDATE frame</a></h3>
<p id="rfc.section.5.2.9.p.1">WINDOW_UPDATE frames do not exist, since QUIC provides equivalent functionality.  Frame type 0x8 is reserved.</p>
<h3 id="rfc.section.5.2.10"><a href="#rfc.section.5.2.10">5.2.10.</a> <a href="#continuation-frame" id="continuation-frame">CONTINUATION frame</a></h3>
<p id="rfc.section.5.2.10.p.1">CONTINUATION frames do not exist, since larger supported HEADERS/PUSH_PROMISE frames provide equivalent functionality. Frame type 0x9 is reserved.</p>
<h3 id="rfc.section.5.2.11"><a href="#rfc.section.5.2.11">5.2.11.</a> <a href="#frame-response" id="frame-response">RESPONSE frame</a></h3>
<p id="rfc.section.5.2.11.p.1">The RESPONSE frame (type=0xB) is used by a server to identify the client&#8217;s Request Control Stream to which the server is responding.  It defines the following flags:</p>
<p/>

<dl>
  <dt>Delta (0x01):</dt>
  <dd style="margin-left: 8">Indicates the length and interpretation of the Stream Reference field.</dd>
  <dt>Direction (0x02):</dt>
  <dd style="margin-left: 8">When the Delta flag is set, indicates whether the reference is to a higher (set) or lower (unset) Stream ID.  MUST NOT be set if the Delta flag is not set.</dd>
</dl>
<div id="rfc.figure.7"/>
<div id="fig-response"/>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Stream Reference (8/32)                  ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p class="figure">Figure 7: RESPONSE frame payload</p>
<p id="rfc.section.5.2.11.p.3">The payload consists of:</p>
<p/>

<dl>
  <dt>Stream Reference:</dt>
  <dd style="margin-left: 8">When the Delta flag is set, this field is 8 bits long and is relative to the current Stream ID.  Otherwise, this field is 32 bits long and is an explicit Stream ID.</dd>
</dl>
<p id="rfc.section.5.2.11.p.5">See <a href="#stream-delta">Section 4.2.3</a> for more information about stream-to-stream references.</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#errors" id="errors">Error Handling</a></h1>
<p id="rfc.section.6.p.1">This section describes the specific error codes defined by HTTP and the mapping of HTTP/2 error codes into the QUIC error code space.</p>
<h2 id="rfc.section.6.1"><a href="#rfc.section.6.1">6.1.</a> <a href="#http-error-codes" id="http-error-codes">HTTP-Defined QUIC Error Codes</a></h2>
<p id="rfc.section.6.1.p.1">QUIC allocates error codes 0x0000-0x3FFF to application protocol definition.  The following error codes are defined by HTTP for use in QUIC RST_STREAM, GOAWAY, and CONNECTION_CLOSE frames.</p>
<p/>

<dl>
  <dt>HTTP_PUSH_REFUSED (0x01):</dt>
  <dd style="margin-left: 8">The server has attempted to push content which the client will not accept on this connection.</dd>
  <dt>HTTP_INTERNAL_ERROR (0x02):</dt>
  <dd style="margin-left: 8">An internal error has occurred in the HTTP stack.</dd>
  <dt>HTTP_PUSH_ALREADY_IN_CACHE (0x03):</dt>
  <dd style="margin-left: 8">The server has attempted to push content which the client has cached.</dd>
  <dt>HTTP_REQUEST_CANCELLED (0x04):</dt>
  <dd style="margin-left: 8">The client no longer needs the requested data.</dd>
  <dt>HTTP_HPACK_DECOMPRESSION_FAILED (0x05):</dt>
  <dd style="margin-left: 8">HPACK failed to decompress a frame and cannot continue.</dd>
  <dt>HTTP_CONNECT_ERROR (0x06):</dt>
  <dd style="margin-left: 8">The connection established in response to a CONNECT request was reset or abnormally closed.</dd>
  <dt>HTTP_EXCESSIVE_LOAD (0x07):</dt>
  <dd style="margin-left: 8">The endpoint detected that its peer is exhibiting a behavior that might be generating excessive load.</dd>
  <dt>HTTP_VERSION_FALLBACK (0x08):</dt>
  <dd style="margin-left: 8">The requested operation cannot be served over HTTP/QUIC.  The peer should retry over HTTP/2.</dd>
  <dt>HTTP_MALFORMED_HEADERS (0x09):</dt>
  <dd style="margin-left: 8">A HEADERS frame has been received with an invalid format.</dd>
  <dt>HTTP_MALFORMED_PRIORITY (0x0A):</dt>
  <dd style="margin-left: 8">A PRIORITY frame has been received with an invalid format.</dd>
  <dt>HTTP_MALFORMED_SETTINGS (0x0B):</dt>
  <dd style="margin-left: 8">A SETTINGS frame has been received with an invalid format.</dd>
  <dt>HTTP_INTERRUPTED_HEADERS (0x0E):</dt>
  <dd style="margin-left: 8">A HEADERS frame without the End Header Block flag was followed by a frame other than HEADERS.</dd>
  <dt>HTTP_SETTINGS_ON_WRONG_STREAM (0x0F):</dt>
  <dd style="margin-left: 8">A SETTINGS frame was received on a request control stream.</dd>
  <dt>HTTP_MULTIPLE_SETTINGS (0x10):</dt>
  <dd style="margin-left: 8">More than one SETTINGS frame was received.</dd>
  <dt>HTTP_INVALID_STREAM_REFERENCE (0x11):</dt>
  <dd style="margin-left: 8">A stream referenced an invalid Stream ID.  See <a href="#stream-delta">Section 4.2.3</a> for more details.</dd>
  <dt>HTTP_DUPLICATE_CONTROL_STREAM (0x12):</dt>
  <dd style="margin-left: 8">A stream other than Stream 2 was declared as a Connection Control Stream.</dd>
  <dt>HTTP_DUPLICATE_REFERENCE (0x13):</dt>
  <dd style="margin-left: 8">Multiple streams attempted to reference the same stream.  See <a href="#stream-delta">Section 4.2.3</a> for more details.</dd>
</dl>
<h2 id="rfc.section.6.2"><a href="#rfc.section.6.2">6.2.</a> <a href="#mapping-http2-error-codes" id="mapping-http2-error-codes">Mapping HTTP/2 Error Codes</a></h2>
<p id="rfc.section.6.2.p.1">The HTTP/2 error codes defined in Section 7 of <a href="#RFC7540">[RFC7540]</a> map to QUIC error codes as follows:</p>
<p/>

<dl>
  <dt>NO_ERROR (0x0):</dt>
  <dd style="margin-left: 8">QUIC_NO_ERROR</dd>
  <dt>PROTOCOL_ERROR (0x1):</dt>
  <dd style="margin-left: 8">No single mapping.  See new HTTP_MALFORMED_* error codes defined in <a href="#http-error-codes">Section 6.1</a>.</dd>
  <dt>INTERNAL_ERROR (0x2)</dt>
  <dd style="margin-left: 8">HTTP_INTERNAL_ERROR in <a href="#http-error-codes">Section 6.1</a>.</dd>
  <dt>FLOW_CONTROL_ERROR (0x3):</dt>
  <dd style="margin-left: 8">Not applicable, since QUIC handles flow control.  Would provoke a QUIC_FLOW_CONTROL_RECEIVED_TOO_MUCH_DATA from the QUIC layer.</dd>
  <dt>SETTINGS_TIMEOUT (0x4):</dt>
  <dd style="margin-left: 8">Not applicable, since no acknowledgement of SETTINGS is defined.</dd>
  <dt>STREAM_CLOSED (0x5):</dt>
  <dd style="margin-left: 8">Not applicable, since QUIC handles stream management.  Would provoke a QUIC_STREAM_DATA_AFTER_TERMINATION from the QUIC layer.</dd>
  <dt>FRAME_SIZE_ERROR (0x6)</dt>
  <dd style="margin-left: 8">No single mapping.  See new error codes defined in <a href="#http-error-codes">Section 6.1</a>.</dd>
  <dt>REFUSED_STREAM (0x7):</dt>
  <dd style="margin-left: 8">Not applicable, since QUIC handles stream management.  Would provoke a QUIC_TOO_MANY_OPEN_STREAMS from the QUIC layer.</dd>
  <dt>CANCEL (0x8):</dt>
  <dd style="margin-left: 8">HTTP_REQUEST_CANCELLED in <a href="#http-error-codes">Section 6.1</a>.</dd>
  <dt>COMPRESSION_ERROR (0x9):</dt>
  <dd style="margin-left: 8">HTTP_HPACK_DECOMPRESSION_FAILED in <a href="#http-error-codes">Section 6.1</a>.</dd>
  <dt>CONNECT_ERROR (0xa):</dt>
  <dd style="margin-left: 8">HTTP_CONNECT_ERROR in <a href="#http-error-codes">Section 6.1</a>.</dd>
  <dt>ENHANCE_YOUR_CALM (0xb):</dt>
  <dd style="margin-left: 8">HTTP_EXCESSIVE_LOAD in <a href="#http-error-codes">Section 6.1</a>.</dd>
  <dt>INADEQUATE_SECURITY (0xc):</dt>
  <dd style="margin-left: 8">Not applicable, since QUIC is assumed to provide sufficient security on all connections.</dd>
  <dt>HTTP_1_1_REQUIRED (0xd):</dt>
  <dd style="margin-left: 8">HTTP_VERSION_FALLBACK in <a href="#http-error-codes">Section 6.1</a>.</dd>
</dl>
<p id="rfc.section.6.2.p.3">TODO: fill in missing error code mappings.</p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a></h1>
<p id="rfc.section.7.p.1">The security considerations of HTTP over QUIC should be comparable to those of HTTP/2.</p>
<p id="rfc.section.7.p.2">The modified SETTINGS format contains nested length elements, which could pose a security risk to an uncautious implementer.  A SETTINGS frame parser MUST ensure that the length of the frame exactly matches the length of the settings it contains.</p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a></h1>
<h2 id="rfc.section.8.1"><a href="#rfc.section.8.1">8.1.</a> <a href="#registration-of-httpquic-identification-string" id="registration-of-httpquic-identification-string">Registration of HTTP/QUIC Identification String</a></h2>
<p id="rfc.section.8.1.p.1">This document creates a new registration for the identification of HTTP/QUIC in the &#8220;Application Layer Protocol Negotiation (ALPN) Protocol IDs&#8221; registry established in <a href="#RFC7301">[RFC7301]</a>.</p>
<p id="rfc.section.8.1.p.2">The &#8220;hq&#8221; string identifies HTTP/QUIC:</p>
<p/>

<dl>
  <dt>Protocol:</dt>
  <dd style="margin-left: 8">HTTP over QUIC</dd>
  <dt>Identification Sequence:</dt>
  <dd style="margin-left: 8">0x68 0x71 (&#8220;hq&#8221;)</dd>
  <dt>Specification:</dt>
  <dd style="margin-left: 8">This document</dd>
</dl>
<h2 id="rfc.section.8.2"><a href="#rfc.section.8.2">8.2.</a> <a href="#registration-of-quic-version-hint-alt-svc-parameter" id="registration-of-quic-version-hint-alt-svc-parameter">Registration of QUIC Version Hint Alt-Svc Parameter</a></h2>
<p id="rfc.section.8.2.p.1">This document creates a new registration for version-negotiation hints in the &#8220;Hypertext Transfer Protocol (HTTP) Alt-Svc Parameter&#8221; registry established in <a href="#RFC7838">[RFC7838]</a>.</p>
<p/>

<dl>
  <dt>Parameter:</dt>
  <dd style="margin-left: 8">&#8220;quic&#8221;</dd>
  <dt>Specification:</dt>
  <dd style="margin-left: 8">This document, <a href="#alt-svc-version-hint">Section 2.1</a></dd>
</dl>
<h2 id="rfc.section.8.3"><a href="#rfc.section.8.3">8.3.</a> <a href="#existing-frame-types" id="existing-frame-types">Existing Frame Types</a></h2>
<p id="rfc.section.8.3.p.1">This document adds two new columns to the &#8220;HTTP/2 Frame Type&#8221; registry defined in <a href="#RFC7540">[RFC7540]</a>:</p>
<p/>

<dl>
  <dt>Supported Protocols:</dt>
  <dd style="margin-left: 8">Indicates which associated protocols use the frame type.  Values MUST be one of: <ul><li>&#8220;HTTP/2 only&#8221;</li><li>&#8220;HTTP/QUIC only&#8221;</li><li>&#8220;Both&#8221;</li></ul><p> </p></dd>
  <dt>HTTP/QUIC Specification:</dt>
  <dd style="margin-left: 8">Indicates where this frame&#8217;s behavior over QUIC is defined; required if the frame is supported over QUIC.</dd>
</dl>
<p id="rfc.section.8.3.p.3">Values for existing registrations are assigned by this document:</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">Frame Type</th>
      <th class="center">Supported Protocols</th>
      <th class="left">HTTP/QUIC Specification</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">DATA</td>
      <td class="center">Both</td>
      <td class="left">
        <a href="#frame-data">Section 5.2.1</a>
      </td>
    </tr>
    <tr>
      <td class="left">HEADERS</td>
      <td class="center">Both</td>
      <td class="left">
        <a href="#frame-headers">Section 5.2.2</a>
      </td>
    </tr>
    <tr>
      <td class="left">PRIORITY</td>
      <td class="center">Both</td>
      <td class="left">
        <a href="#frame-priority">Section 5.2.3</a>
      </td>
    </tr>
    <tr>
      <td class="left">RST_STREAM</td>
      <td class="center">HTTP/2 only</td>
      <td class="left">N/A</td>
    </tr>
    <tr>
      <td class="left">SETTINGS</td>
      <td class="center">Both</td>
      <td class="left">
        <a href="#frame-settings">Section 5.2.5</a>
      </td>
    </tr>
    <tr>
      <td class="left">PUSH_PROMISE</td>
      <td class="center">Both</td>
      <td class="left">
        <a href="#frame-push-promise">Section 5.2.6</a>
      </td>
    </tr>
    <tr>
      <td class="left">PING</td>
      <td class="center">HTTP/2 only</td>
      <td class="left">N/A</td>
    </tr>
    <tr>
      <td class="left">GOAWAY</td>
      <td class="center">HTTP/2 only</td>
      <td class="left">N/A</td>
    </tr>
    <tr>
      <td class="left">WINDOW_UPDATE</td>
      <td class="center">HTTP/2 only</td>
      <td class="left">N/A</td>
    </tr>
    <tr>
      <td class="left">CONTINUATION</td>
      <td class="center">HTTP/2 only</td>
      <td class="left">N/A</td>
    </tr>
  </tbody>
</table>
<p id="rfc.section.8.3.p.4">The &#8220;Specification&#8221; column is renamed to &#8220;HTTP/2 specification&#8221; and is only required if the frame is supported over HTTP/2.</p>
<p id="rfc.section.8.3.p.5">One new frame type is added by this document:</p>
<p/>

<dl>
  <dt>Frame Type:</dt>
  <dd style="margin-left: 8">RESPONSE</dd>
  <dt>Code:</dt>
  <dd style="margin-left: 8">0x0B</dd>
  <dt>Supported Protocols:</dt>
  <dd style="margin-left: 8">HTTP/QUIC only</dd>
  <dt>HTTP/QUIC Specification:</dt>
  <dd style="margin-left: 8">
    <a href="#frame-response">Section 5.2.11</a>
  </dd>
</dl>
<h1 id="rfc.references"><a href="#rfc.references">9.</a> References</h1>
<h2 id="rfc.references.1"><a href="#rfc.references.1">9.1.</a> Normative References</h2>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="QUIC-TRANSPORT">[QUIC-TRANSPORT]</b>
      </td>
      <td class="top"><a title="Google">Iyengar, J.</a> and <a title="Mozilla">M. Thomson</a>, "<a>QUIC: A UDP-Based Multiplexed and Secure Transport</a>"</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC0793">[RFC0793]</b>
      </td>
      <td class="top"><a>Postel, J.</a>, "<a href="http://tools.ietf.org/html/rfc793">Transmission Control Protocol</a>", STD 7, RFC 793, DOI 10.17487/RFC0793, September 1981.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a>Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7230">[RFC7230]</b>
      </td>
      <td class="top"><a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="http://tools.ietf.org/html/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>", RFC 7230, DOI 10.17487/RFC7230, June 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7231">[RFC7231]</b>
      </td>
      <td class="top"><a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="http://tools.ietf.org/html/rfc7231">Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content</a>", RFC 7231, DOI 10.17487/RFC7231, June 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7540">[RFC7540]</b>
      </td>
      <td class="top"><a>Belshe, M.</a>, <a>Peon, R.</a> and <a>M. Thomson</a>, "<a href="http://tools.ietf.org/html/rfc7540">Hypertext Transfer Protocol Version 2 (HTTP/2)</a>", RFC 7540, DOI 10.17487/RFC7540, May 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7541">[RFC7541]</b>
      </td>
      <td class="top"><a>Peon, R.</a> and <a>H. Ruellan</a>, "<a href="http://tools.ietf.org/html/rfc7541">HPACK: Header Compression for HTTP/2</a>", RFC 7541, DOI 10.17487/RFC7541, May 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7838">[RFC7838]</b>
      </td>
      <td class="top"><a>Nottingham, M.</a>, <a>McManus, P.</a> and <a>J. Reschke</a>, "<a href="http://tools.ietf.org/html/rfc7838">HTTP Alternative Services</a>", RFC 7838, DOI 10.17487/RFC7838, April 2016.</td>
    </tr>
  </tbody>
</table>
<h2 id="rfc.references.2"><a href="#rfc.references.2">9.2.</a> Informative References</h2>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC7301">[RFC7301]</b>
      </td>
      <td class="top"><a>Friedl, S.</a>, <a>Popov, A.</a>, <a>Langley, A.</a> and <a>E. Stephan</a>, "<a href="http://tools.ietf.org/html/rfc7301">Transport Layer Security (TLS) Application-Layer Protocol Negotiation Extension</a>", RFC 7301, DOI 10.17487/RFC7301, July 2014.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.appendix.A"><a href="#rfc.appendix.A">Appendix A.</a> <a href="#contributors" id="contributors">Contributors</a></h1>
<p id="rfc.section.A.p.1">The original authors of this specification were Robbie Shade and Mike Warres.</p>
<h1 id="rfc.appendix.B"><a href="#rfc.appendix.B">Appendix B.</a> <a href="#change-log" id="change-log">Change Log</a></h1>
<p/>

<ul class="empty">
  <li><strong>RFC Editor&#8217;s Note:</strong>  Please remove this section prior to publication of a final version of this document.</li>
</ul>
<h2 id="rfc.appendix.B.1"><a href="#rfc.appendix.B.1">B.1.</a> <a href="#since-draft-ietf-quic-http-01" id="since-draft-ietf-quic-http-01">Since draft-ietf-quic-http-01:</a></h2>
<p/>

<ul>
  <li>SETTINGS can be sent only one at the start of a connection.  SETTINGS_ACK removed.</li>
</ul>
<h2 id="rfc.appendix.B.2"><a href="#rfc.appendix.B.2">B.2.</a> <a href="#since-draft-ietf-quic-http-00" id="since-draft-ietf-quic-http-00">Since draft-ietf-quic-http-00:</a></h2>
<p/>

<ul>
  <li>Changed &#8220;HTTP/2-over-QUIC&#8221; to &#8220;HTTP/QUIC&#8221; throughout</li>
  <li>Changed from using HTTP/2 framing within Stream 3 to new framing format and two-stream-per-request model</li>
  <li>Adopted SETTINGS format from draft-bishop-httpbis-extended-settings-01</li>
  <li>Reworked SETTINGS_ACK to account for indeterminate inter-stream order.</li>
  <li>Described CONNECT pseudo-method</li>
  <li>Updated ALPN token and Alt-Svc guidance</li>
  <li>Application-layer-defined error codes</li>
</ul>
<h2 id="rfc.appendix.B.3"><a href="#rfc.appendix.B.3">B.3.</a> <a href="#since-draft-shade-quic-http2-mapping-00" id="since-draft-shade-quic-http2-mapping-00">Since draft-shade-quic-http2-mapping-00:</a></h2>
<p/>

<ul>
  <li>Adopted as base for draft-ietf-quic-http.</li>
  <li>Updated authors/editors list.</li>
</ul>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Author's Address</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Mike Bishop</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Bishop</span>
	  </span>
	</span>
	<span class="org vcardline">Microsoft</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:Michael.Bishop@microsoft.com">Michael.Bishop@microsoft.com</a></span>

  </address>
</div>

  <div class="github-fork-ribbon-wrapper"><div class="github-fork-ribbon"><a href="https://github.com/quicwg/base-drafts">Fork me on GitHub</a></div></div>
</body>
</html>
